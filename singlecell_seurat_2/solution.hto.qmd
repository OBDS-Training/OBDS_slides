---
title: "Solution: Single-cell analysis using Seurat, part 2 (HTO)"
author: "Kevin Rue-Albrecht"
date: "2023-06-08"
date-format: long
format: html
---

```{r}
#| label: load-packages
#| include: false
library(Seurat)
library(gprofiler2)
```

## Goal

Demultiplexing with hashtag oligos (HTOs).

- Single cells collected from four cell lines: HEK, K562, KG1 and THP1.
- Each cell line was further split into three samples (12 samples in total).
- Each sample was labelled with a hashing antibody mixture (CD29 and CD45), pooled, and run on a single channel of 10X.
- Based on this design, we should be able to detect doublets both across and within cell types.

## Exercise

### Read in the HTO and UMI matrices

Import the UMI matrix from the file `hto12_umi_mtx.rds` and check its class.

```{r}
hto12_umis <- readRDS("data/hto12_umi_mtx.rds")
class(hto12_umis)
```

Check its dimensions.

```{r}
dim(hto12_umis)
```


Import the HTO matrix from the file `hto12_hto_mtx.rds` and check its class.

```{r}
hto12_htos <- readRDS("data/hto12_hto_mtx.rds")
class(hto12_htos)
```

Check its dimensions.

```{r}
dim(hto12_htos)
```

### Preprocessing

Subset the HTO data frame to only include barcodes present in the UMI matrix.

**Hint:**

- Create a character vector that is the intersection of barcodes in the UMI matrix and HTO data frame.

```{r}
joint_barcodes <- intersect(rownames(hto12_htos), colnames(hto12_umis))
length(joint_barcodes)
```