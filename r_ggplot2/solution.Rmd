---
title: "Example code for ggplot2"
author: "Kevin Rue-Albrecht"
date: "09/06/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(ggrepel)
library(cowplot)
library(patchwork)
library(gridExtra)
```

# Exercise

## Specify the dataset.

Use `library(ggplot2)` to load the package.

```{r}
library(ggplot2)
```

What does `ggplot(diamonds)` do?

```{r}
ggplot(diamonds)
```

## Add the aesthetics.

What does `ggplot(diamonds, aes(x = carat, y = price))` do?

```{r}
ggplot(diamonds, aes(x = carat, y = price))
```

## Add geometric objects

- Add data points showing `carat` on the x-axis and `price` on the y-axis.

```{r}
ggplot(diamonds, aes(x = carat, y = price)) +
  geom_point()
```

- Color data points by `cut`.

```{r}
ggplot(diamonds, aes(x = carat, y = price, color = cut)) +
  geom_point()
```

- Add a smoothed mean trendline.

```{r}
ggplot(diamonds, aes(x = carat, y = price, color = cut)) +
  geom_point() +
  geom_smooth()
```

- Save the last plot as `obds_diamonds`.

```{r}
obds_diamonds <- ggplot(diamonds, aes(x = carat, y = price, color = cut)) +
  geom_point() +
  geom_smooth()
```


# Exercise

## Predict the difference between these two plots

### Plot 1

```{r, include=TRUE}
ggplot(diamonds, aes(x = carat, y = price, colour = cut)) +
  geom_point() +
  geom_smooth()
```

### Plot 2

```{r, include=TRUE}
ggplot(diamonds, aes(x = carat, y = price)) +
  geom_point(aes(colour = cut)) +
  geom_smooth()
```

# Exercise

## Time series

Using the built-in `ChickWeight` data set:

- Create a scatter plot of weight (y-axis) over time (x-axis).

```{r}
ggplot(ChickWeight, aes(Time, weight)) +
  geom_point()
```

- Color by diet.

```{r}
ggplot(ChickWeight) +
  geom_point(aes(Time, weight, color = Diet))
```

- Add a linear mean trend line for each diet.

```{r}
ggplot(ChickWeight, aes(Time, weight, color = Diet)) +
  geom_point() +
  geom_smooth(method = "lm", formula = y ~ x)
```

- Which diet leads to the highest mean increase in weight?

```{r}
"Diet 3"
```

- Facet a ribbon of sub-plots, one per diet.

```{r}
ggplot(ChickWeight, aes(Time, weight, color = Diet)) +
  geom_point() +
  geom_smooth(method = "lm", formula = y ~ x) +
  facet_wrap(~Diet)
```

- Save the last plot as `obds_chickweight`.

```{r}
obds_chickweight <- ggplot(ChickWeight, aes(Time, weight, color = Diet)) +
  geom_point() +
  geom_smooth(method = "lm", formula = y ~ x) +
  facet_wrap(~Diet)
```

# Exercise

## Bar plot

- Load the `ggplot2::msleep` data set.

```{r}
data(msleep)
head(msleep)
```

- Draw a bar plot of number of observations by taxonomic order.

```{r}
ggplot(msleep, aes(order)) +
  geom_bar()
```

- Change the angle and font size of the x-axis tick labels.

> You will probably want to justify the text labels as right-aligned.

```{r}
ggplot(msleep, aes(order)) +
  geom_bar() +
  theme(
    axis.text.x = element_text(size = rel(1.5), angle = 60, hjust = 1, vjust = 1)
    )
```

- Change the label and font size of the axes.

```{r}
ggplot(msleep, aes(order)) +
  geom_bar() +
  labs(x = "Taxonomic order", y = "Observations") +
  theme(
    axis.text.x = element_text(size = rel(1.5), angle = 60, hjust = 1, vjust = 1),
    axis.title = element_text(size = rel(2))
    )
```

- Fill each bar with colors, proportionally to the count of each genus.

> You may need to iteratively resize the labels of the ticks and axes.

```{r}
ggplot(msleep, aes(order)) +
  geom_bar(aes(fill = genus)) +
  labs(x = "Taxonomic order", y = "Observations") +
  theme(
    axis.text.x = element_text(size = rel(1.5), angle = 60, hjust = 1, vjust = 1),
    axis.title = element_text(size = rel(2))
    )
```

- Reduce the legend key size.
  (Recommendation: use `unit(2, "mm")`).

```{r}
ggplot(msleep, aes(order)) +
  geom_bar(aes(fill = genus)) +
  labs(x = "Taxonomic order", y = "Observations") +
  theme(
    axis.text.x = element_text(size = rel(1.5), angle = 60, hjust = 1, vjust = 1),
    axis.title = element_text(size = rel(2)),
    legend.key.size = unit(2, "mm")
    )
```

- Force the legend to be display in 3 columns.
 (Recommendation: use `guide_legend(...)`).

```{r}
ggplot(msleep, aes(order)) +
  geom_bar(aes(fill = genus)) +
  labs(x = "Taxonomic order", y = "Observations") +
  theme(
    axis.text.x = element_text(size = rel(1.2), angle = 60, hjust = 1, vjust = 1),
    axis.text.y = element_text(size = rel(1.2)),
    axis.title = element_text(size = rel(1.5)),
    legend.key.size = unit(2, "mm")
    ) +
  guides(fill = guide_legend(ncol = 3))
```

- Add a contour of thin black lines to the bars.

```{r}
ggplot(msleep, aes(order)) +
  geom_bar(aes(fill = genus), color = "black", size = 0.2) +
  labs(x = "Taxonomic order", y = "Observations") +
  theme(
    axis.text.x = element_text(size = rel(1.2), angle = 60, hjust = 1, vjust = 1),
    axis.text.y = element_text(size = rel(1.2)),
    axis.title = element_text(size = rel(1.5)),
    legend.key.size = unit(2, "mm")
    ) +
  guides(fill = guide_legend(ncol = 3))
```

- Save the last plot as `obds_msleep`.

```{r}
obds_msleep <- ggplot(msleep, aes(order)) +
  geom_bar(aes(fill = genus), color = "black", size = 0.2) +
  labs(x = "Taxonomic order", y = "Observations") +
  theme(
    axis.text.x = element_text(size = rel(1.2), angle = 60, hjust = 1, vjust = 1),
    axis.text.y = element_text(size = rel(1.2)),
    axis.title = element_text(size = rel(1.5)),
    legend.key.size = unit(2, "mm")
    ) +
  guides(fill = guide_legend(ncol = 3))
```

# Exercise

## Plotting grid

- Collate the plots that we saved through the day, as a single plot.

  + Plots: `obds_diamonds`, `obds_chickweight`, `obds_msleep`.
  
  + Methods: `cowplot::plot_grid()`, `patchwork`, `gridExtra::grid.arrange()`.

```{r}
first_row <- cowplot::plot_grid(
  obds_diamonds, obds_chickweight,
  ncol = 2
)
second_row <- cowplot::plot_grid(
  obds_msleep, ncol = 1
)
super_plot <- cowplot::plot_grid(
  first_row, second_row,
  nrow = 2
)
```

- Save the new plot in a PDF file.

> You will likely need a few attempts to fine-tune the width and height of the output file.

```{r}
ggsave("final_plot.pdf", super_plot, width = 12, height = 12)
```

```{r, fig.height=12, fig.width=12}
library(patchwork)
(obds_diamonds + obds_chickweight) / obds_msleep
```

```{r, fig.height=12, fig.width=12}
library(gridExtra)
grid.arrange(
  grobs=list(obds_diamonds, obds_chickweight, obds_msleep),
  layout_matrix = rbind(c(1, 2),
                 c(3, 3))
)
```

# Exercise

## Pair programming

- Explore the data set `ggplot2::mpg` and generate the most informative plot that you can!

```{r}
ggplot(mpg, aes(cty, hwy, color = year)) +
  geom_abline(slope = 1, intercept = 0) +
  geom_point(size = 0.5) +
  facet_wrap(~manufacturer)
```
